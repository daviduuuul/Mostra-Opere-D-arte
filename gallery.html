<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claudio Paolinelli — Galleria Natura</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Jost:wght@200;300;400&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
:root{--warm:#c8a97e;--warm2:#e8c89a;--cream:#f5ede0;--dark:#0f0b07}
body{background:var(--dark);color:var(--cream);font-family:'Jost',sans-serif;overflow:hidden;cursor:none}

/* CURSOR */
#cursor{width:9px;height:9px;border:1px solid var(--warm);border-radius:50%;position:fixed;pointer-events:none;z-index:9999;transition:transform .12s,opacity .3s;transform:translate(-50%,-50%)}
#cursor.hidden{opacity:0}

/* ── LOADING ─────────────────────────────────────────────────────────────── */
#loading{
  position:fixed;inset:0;z-index:600;
  background:var(--dark);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:0;
  transition:opacity 1.1s ease;
}
#loading.fade{opacity:0;pointer-events:none}
.ld-eyebrow{
  font-family:'Jost',sans-serif;font-weight:200;font-size:10px;
  letter-spacing:7px;text-transform:uppercase;color:rgba(200,169,126,.4);
  margin-bottom:28px;
}
.ld-name{
  font-family:'Cormorant Garamond',serif;font-weight:300;
  font-size:clamp(38px,5vw,62px);color:var(--cream);letter-spacing:3px;
  margin-bottom:48px;
}
.ld-name em{font-style:italic;color:var(--warm)}
.ld-bar-wrap{width:180px;height:1px;background:rgba(200,169,126,.12);margin-bottom:18px}
.ld-bar{height:100%;width:0%;background:var(--warm);transition:width .35s ease}
.ld-pct{
  font-family:'Jost',sans-serif;font-weight:200;font-size:10px;
  letter-spacing:4px;color:rgba(200,169,126,.38);
}

/* ── INTRO ───────────────────────────────────────────────────────────────── */
#intro{
  position:fixed;inset:0;z-index:100;
  display:flex;align-items:stretch;
  background:var(--dark);
  opacity:0;transition:opacity 1.6s ease;
  pointer-events:none;
}
#intro.visible{opacity:1;pointer-events:all}

/* Left panel — decorative image strip */
.intro-left{
  width:42%;position:relative;overflow:hidden;flex-shrink:0;
}
.intro-left-img{
  position:absolute;inset:0;
  background-image:url('https://images.unsplash.com/photo-1448375240586-882707db888b?w=900&q=85');
  background-size:cover;background-position:center;
  transform:scale(1.04);
  transition:transform 8s ease;
}
#intro.visible .intro-left-img{transform:scale(1.0)}
.intro-left-overlay{
  position:absolute;inset:0;
  background:linear-gradient(to right, rgba(15,11,7,.1) 0%, rgba(15,11,7,.55) 100%),
             linear-gradient(to bottom, rgba(15,11,7,.3) 0%, transparent 30%, transparent 70%, rgba(15,11,7,.5) 100%);
}
/* Vertical text on left */
.intro-left-label{
  position:absolute;bottom:48px;left:32px;
  font-family:'Jost',sans-serif;font-weight:200;font-size:9px;
  letter-spacing:5px;text-transform:uppercase;color:rgba(245,237,224,.4);
  writing-mode:vertical-rl;transform:rotate(180deg);
}
/* Year badge */
.intro-year{
  position:absolute;top:40px;right:28px;
  font-family:'Cormorant Garamond',serif;font-style:italic;
  font-size:13px;color:rgba(200,169,126,.5);letter-spacing:2px;
}

/* Right panel — content */
.intro-right{
  flex:1;display:flex;flex-direction:column;justify-content:center;
  padding:64px 72px 64px 64px;position:relative;
  background:var(--dark);
}
/* subtle right-side grain */
.intro-right::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse at 30% 40%,rgba(139,90,43,.13) 0%,transparent 60%),
             radial-gradient(ellipse at 80% 80%,rgba(100,60,20,.08) 0%,transparent 50%);
  pointer-events:none;
}

.ir-eyebrow{
  font-family:'Jost',sans-serif;font-weight:200;font-size:10px;
  letter-spacing:7px;text-transform:uppercase;color:var(--warm);
  margin-bottom:24px;
  opacity:0;
}
#intro.visible .ir-eyebrow{animation:fadeUp .9s .2s forwards}

.ir-name{
  font-family:'Cormorant Garamond',serif;font-weight:300;
  font-size:clamp(44px,5.5vw,78px);line-height:.92;
  color:var(--cream);margin-bottom:6px;
  opacity:0;
}
#intro.visible .ir-name{animation:fadeUp .9s .4s forwards}
.ir-name em{display:block;font-style:italic;color:var(--warm);font-size:1.08em}

.ir-divider{
  display:flex;align-items:center;gap:16px;margin:30px 0 28px;
  opacity:0;
}
#intro.visible .ir-divider{animation:fadeUp .9s .55s forwards}
.ir-divider-line{flex:1;max-width:48px;height:1px;background:rgba(200,169,126,.35)}
.ir-divider-dot{width:3px;height:3px;border-radius:50%;background:var(--warm);opacity:.6}

.ir-bio{
  font-family:'Cormorant Garamond',serif;font-size:17px;font-weight:300;
  line-height:1.82;color:rgba(245,237,224,.62);
  max-width:380px;margin-bottom:14px;
  opacity:0;
}
#intro.visible .ir-bio{animation:fadeUp .9s .7s forwards}

.ir-stats{
  display:flex;gap:32px;margin-bottom:48px;
  opacity:0;
}
#intro.visible .ir-stats{animation:fadeUp .9s .82s forwards}
.ir-stat-num{
  font-family:'Cormorant Garamond',serif;font-size:28px;font-weight:300;
  color:var(--warm2);line-height:1;margin-bottom:4px;
}
.ir-stat-label{
  font-family:'Jost',sans-serif;font-weight:200;font-size:9px;
  letter-spacing:3px;text-transform:uppercase;color:rgba(245,237,224,.35);
}

/* Enter button — redesigned */
.ir-enter-wrap{
  display:flex;align-items:center;gap:20px;
  opacity:0;
}
#intro.visible .ir-enter-wrap{animation:fadeUp .9s .96s forwards}
.ir-enter{
  position:relative;display:flex;align-items:center;gap:14px;
  font-family:'Jost',sans-serif;font-weight:300;font-size:11px;
  letter-spacing:5px;text-transform:uppercase;color:var(--dark);
  background:var(--warm);padding:14px 32px;
  cursor:pointer;overflow:hidden;border:none;outline:none;
  transition:background .35s ease;
}
.ir-enter::after{
  content:'';position:absolute;inset:0;
  background:var(--warm2);
  transform:translateX(-100%);transition:transform .4s ease;
}
.ir-enter:hover::after{transform:translateX(0)}
.ir-enter span{position:relative;z-index:1}
.ir-enter-arrow{
  position:relative;z-index:1;
  width:18px;height:1px;background:var(--dark);
  transition:width .3s ease;
}
.ir-enter-arrow::after{
  content:'';position:absolute;right:0;top:-3px;
  border:3px solid transparent;border-left:5px solid var(--dark);
}
.ir-enter:hover .ir-enter-arrow{width:28px}
.ir-enter-ghost{
  font-family:'Jost',sans-serif;font-weight:200;font-size:9px;
  letter-spacing:4px;text-transform:uppercase;color:rgba(200,169,126,.35);
  cursor:pointer;padding:14px 0;border:none;outline:none;background:none;
  transition:color .3s;
}
.ir-enter-ghost:hover{color:rgba(200,169,126,.7)}

/* Bottom strip on intro right */
.ir-bottom{
  position:absolute;bottom:40px;left:72px;right:72px;
  display:flex;justify-content:space-between;align-items:flex-end;
  opacity:0;
}
#intro.visible .ir-bottom{animation:fadeUp .9s 1.1s forwards}
.ir-bottom-tag{
  font-family:'Jost',sans-serif;font-weight:200;font-size:9px;
  letter-spacing:4px;text-transform:uppercase;color:rgba(200,169,126,.2);
}
.ir-count{
  font-family:'Cormorant Garamond',serif;font-style:italic;
  font-size:13px;color:rgba(200,169,126,.3);letter-spacing:1px;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(14px)}
  to{opacity:1;transform:translateY(0)}
}

/* ── CANVAS ──────────────────────────────────────────────────────────────── */
/* z-index:-1 keeps it behind loading AND intro screens always */
#canvas{display:block;position:fixed;inset:0;z-index:0}
#loading{z-index:600}
#intro{z-index:100}

/* ── HUD ─────────────────────────────────────────────────────────────────── */
#hud{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);z-index:50;display:none;flex-direction:column;align-items:center;gap:10px;opacity:0;transition:opacity 1.2s ease}
.hud-keys{display:flex;gap:5px;align-items:center}
.key{width:28px;height:28px;border:1px solid rgba(200,169,126,.2);display:flex;align-items:center;justify-content:center;font-size:11px;color:rgba(200,169,126,.4);font-family:'Jost',sans-serif;font-weight:300}
.hud-label{font-family:'Jost',sans-serif;font-weight:200;font-size:10px;letter-spacing:4px;text-transform:uppercase;color:rgba(200,169,126,.28)}

/* ── CROSSHAIR ───────────────────────────────────────────────────────────── */
#crosshair{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:16px;height:16px;pointer-events:none;z-index:50;display:none;opacity:.28;transition:opacity .2s}
#crosshair.active{opacity:.9}
#crosshair::before,#crosshair::after{content:'';position:absolute;background:var(--warm)}
#crosshair::before{width:1px;height:100%;left:50%;top:0;transform:translateX(-50%)}
#crosshair::after{height:1px;width:100%;top:50%;left:0;transform:translateY(-50%)}
#interact-hint{position:fixed;top:50%;left:50%;transform:translate(-50%,calc(-50% + 22px));font-family:'Jost',sans-serif;font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--warm);pointer-events:none;z-index:50;display:none;opacity:0;transition:opacity .2s;text-shadow:0 0 12px rgba(200,169,126,.45)}

/* ── LOCK MSG ────────────────────────────────────────────────────────────── */
#lock-msg{position:fixed;inset:0;z-index:60;display:none;align-items:center;justify-content:center;pointer-events:none}
#lock-msg span{font-family:'Jost',sans-serif;font-weight:200;font-size:11px;letter-spacing:5px;text-transform:uppercase;color:rgba(200,169,126,.45);padding:12px 28px;border:1px solid rgba(200,169,126,.15);background:rgba(15,11,7,.8);backdrop-filter:blur(4px)}

/* ── PHOTO OVERLAY ───────────────────────────────────────────────────────── */
#photo-overlay{position:fixed;inset:0;z-index:200;display:none;align-items:center;justify-content:center;background:rgba(10,7,3,.95);backdrop-filter:blur(12px);opacity:0;transition:opacity .5s ease}
.photo-frame-outer{position:relative}
.photo-frame-border{border:20px solid #2a1606;box-shadow:inset 0 0 0 1px rgba(200,169,126,.48),inset 0 0 0 3px #170b02,inset 0 0 0 4px rgba(200,169,126,.18),0 50px 140px rgba(0,0,0,.9),0 0 0 1px rgba(200,169,126,.08)}
.photo-frame-border img{display:block;max-width:64vw;max-height:66vh;object-fit:contain}
.photo-caption{text-align:center;margin-top:22px;font-family:'Cormorant Garamond',serif;font-style:italic;font-size:17px;color:rgba(245,237,224,.45);letter-spacing:1.5px}
.photo-close{position:absolute;top:-44px;right:0;font-family:'Jost',sans-serif;font-size:10px;letter-spacing:4px;color:rgba(200,169,126,.4);cursor:pointer;text-transform:uppercase;transition:color .25s;user-select:none}
.photo-close:hover{color:var(--warm)}
</style>
</head>
<body>

<div id="cursor"></div>

<!-- LOADING -->
<div id="loading">
  <div class="ld-eyebrow">Galleria Fotografica</div>
  <div class="ld-name">Claudio <em>Paolinelli</em></div>
  <div class="ld-bar-wrap"><div class="ld-bar" id="ldBar"></div></div>
  <div class="ld-pct" id="ldPct">0%</div>
</div>

<!-- INTRO — two-panel layout -->
<div id="intro">
  <!-- Left: image -->
  <div class="intro-left">
    <div class="intro-left-img"></div>
    <div class="intro-left-overlay"></div>
    <div class="intro-left-label">Fotografia Naturalistica</div>
    <div class="intro-year">Est. 2003</div>
  </div>
  <!-- Right: content -->
  <div class="intro-right">
    <div class="ir-eyebrow">Galleria Immersiva</div>
    <div class="ir-name">Claudio<em>Paolinelli</em></div>

    <div class="ir-divider">
      <div class="ir-divider-line"></div>
      <div class="ir-divider-dot"></div>
      <div class="ir-divider-dot"></div>
      <div class="ir-divider-dot"></div>
    </div>

    <div class="ir-bio">
      Fotografo naturalista italiano con oltre vent'anni di esperienza
      nell'immortalare la bellezza selvaggia del mondo. Dalle cascate alpine
      ai silenzi delle foreste tropicali — quei momenti effimeri in cui
      luce, acqua e vita si incontrano.
    </div>

    <div class="ir-stats">
      <div>
        <div class="ir-stat-num">10</div>
        <div class="ir-stat-label">Opere esposte</div>
      </div>
      <div>
        <div class="ir-stat-num">22+</div>
        <div class="ir-stat-label">Anni di carriera</div>
      </div>
      <div>
        <div class="ir-stat-num">360°</div>
        <div class="ir-stat-label">Esplorazione libera</div>
      </div>
    </div>

    <div class="ir-enter-wrap">
      <button class="ir-enter" id="enterBtn">
        <span>Entra nella Galleria</span>
        <div class="ir-enter-arrow"></div>
      </button>
    </div>

    <div class="ir-bottom">
      <div class="ir-bottom-tag">© 2026 Claudio Paolinelli</div>
      <div class="ir-count">10 fotografie · natura &amp; paesaggio</div>
    </div>
  </div>
</div>

<!-- HUD -->
<div id="hud">
  <div class="hud-keys">
    <div class="key">W</div><div class="key">A</div>
    <div class="key">S</div><div class="key">D</div>
  </div>
  <div class="hud-label">WASD per muoverti · Mouse per guardare · E per aprire</div>
</div>

<div id="crosshair"></div>
<div id="interact-hint">[ E ] Apri opera</div>
<div id="lock-msg"><span>Clicca per riprendere il controllo</span></div>

<!-- Canvas hidden until scene ready -->
<canvas id="canvas"></canvas>

<div id="photo-overlay">
  <div class="photo-frame-outer">
    <div class="photo-close" id="photoClose">✕ &nbsp;Chiudi</div>
    <div class="photo-frame-border">
      <img id="overlayImg" src="" alt="">
    </div>
    <div class="photo-caption" id="photoCaption"></div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
'use strict';

const PHOTOS=[
  {url:'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?w=1400&q=90',title:'Nebbia al Mattino'},
  {url:'https://images.unsplash.com/photo-1433086966358-54859d0ed716?w=1400&q=90',title:'La Grande Cascata'},
  {url:'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1400&q=90',title:'Luce nella Foresta'},
  {url:'https://images.unsplash.com/photo-1504893524553-b855bce32c67?w=1400&q=90',title:'Fiume di Pietra'},
  {url:'https://images.unsplash.com/photo-1426604966848-d7adac402bff?w=1400&q=90',title:'Prato Infinito'},
  {url:'https://images.unsplash.com/photo-1516912481808-3406841bd33c?w=1400&q=90',title:"L'Alba sulle Rocce"},
  {url:'https://images.unsplash.com/photo-1501854140801-50d01698950b?w=1400&q=90',title:'Montagne Silenziose'},
  {url:'https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?w=1400&q=90',title:'Riflesso sul Lago'},
  {url:'https://images.unsplash.com/photo-1520962922320-2038eebab146?w=1400&q=90',title:'Cascata Nascosta'},
  {url:'https://images.unsplash.com/photo-1448375240586-882707db888b?w=1400&q=90',title:'Respiro del Bosco'},
];

const TEX={
  floorColor: 'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/wood_floor_deck/wood_floor_deck_diff_1k.jpg',
  floorNormal:'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/wood_floor_deck/wood_floor_deck_nor_gl_1k.jpg',
  floorRough: 'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/wood_floor_deck/wood_floor_deck_rough_1k.jpg',
  wallColor:  'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/painted_plaster_wall/painted_plaster_wall_diff_1k.jpg',
  wallNormal: 'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/painted_plaster_wall/painted_plaster_wall_nor_gl_1k.jpg',
  wallRough:  'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/painted_plaster_wall/painted_plaster_wall_rough_1k.jpg',
  ceilColor:  'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/concrete_wall_008/concrete_wall_008_diff_1k.jpg',
  ceilNormal: 'https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/concrete_wall_008/concrete_wall_008_nor_gl_1k.jpg',
};

// ── RENDERER ─────────────────────────────────────────────────────────────────
const canvas=document.getElementById('canvas');
const renderer=new THREE.WebGLRenderer({canvas,antialias:true,powerPreference:'high-performance'});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.shadowMap.enabled=true;
renderer.shadowMap.type=THREE.PCFSoftShadowMap;
renderer.physicallyCorrectLights=true;
renderer.toneMapping=THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure=1.38;

const scene=new THREE.Scene();
scene.background=new THREE.Color(0x0d0906);
scene.fog=new THREE.FogExp2(0x0d0906,0.038);

const camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.05,100);
camera.position.set(0,1.72,15);

const TL=new THREE.TextureLoader();
const maxAniso=renderer.capabilities.getMaxAnisotropy();

function loadTex(url,repeat=[1,1],encoding=THREE.sRGBEncoding){
  return new Promise(resolve=>{
    TL.load(url,tex=>{
      tex.encoding=encoding;
      tex.wrapS=tex.wrapT=THREE.RepeatWrapping;
      tex.repeat.set(...repeat);
      tex.anisotropy=maxAniso;
      resolve(tex);
    },undefined,()=>{
      // fallback: plain colour canvas
      const c=document.createElement('canvas');c.width=c.height=4;
      const ctx=c.getContext('2d');
      ctx.fillStyle=encoding===THREE.sRGBEncoding?'#7a5a38':'#8080ff';
      ctx.fillRect(0,0,4,4);
      const t=new THREE.CanvasTexture(c);t.encoding=encoding;resolve(t);
    });
  });
}

const CL=38,CW=5.4,WH=4.1;
const hw=CW/2,hl=CL/2;
const photoMeshes=[];

// Progress tracking
let loaded=0;
const TOTAL_ASSETS=8+10; // 8 PBR textures + 10 photos
const ldBar=document.getElementById('ldBar');
const ldPct=document.getElementById('ldPct');
function tickProgress(){
  loaded++;
  const p=Math.round((loaded/TOTAL_ASSETS)*100);
  ldBar.style.width=p+'%';
  ldPct.textContent=p+'%';
}

async function buildScene(){

  // ── Load PBR textures ───────────────────────────────────────────────────
  const texResults=await Promise.all([
    loadTex(TEX.floorColor, [10,1]).then(t=>{tickProgress();return t}),
    loadTex(TEX.floorNormal,[10,1],THREE.LinearEncoding).then(t=>{tickProgress();return t}),
    loadTex(TEX.floorRough, [10,1],THREE.LinearEncoding).then(t=>{tickProgress();return t}),
    loadTex(TEX.wallColor,  [6,2]).then(t=>{tickProgress();return t}),
    loadTex(TEX.wallNormal, [6,2],THREE.LinearEncoding).then(t=>{tickProgress();return t}),
    loadTex(TEX.wallRough,  [6,2],THREE.LinearEncoding).then(t=>{tickProgress();return t}),
    loadTex(TEX.ceilColor,  [5,2]).then(t=>{tickProgress();return t}),
    loadTex(TEX.ceilNormal, [5,2],THREE.LinearEncoding).then(t=>{tickProgress();return t}),
  ]);
  const [floorD,floorN,floorR,wallD,wallN,wallR,ceilD,ceilN]=texResults;

  // ── Materials ────────────────────────────────────────────────────────────
  const matFloor=new THREE.MeshStandardMaterial({map:floorD,normalMap:floorN,roughnessMap:floorR,roughness:.72,metalness:.03,color:0xb07840,normalScale:new THREE.Vector2(1.1,1.1)});
  const matWall =new THREE.MeshStandardMaterial({map:wallD, normalMap:wallN, roughnessMap:wallR, roughness:.92,metalness:.0, color:0xc8a070,normalScale:new THREE.Vector2(.7,.7)});
  const matCeil =new THREE.MeshStandardMaterial({map:ceilD, normalMap:ceilN,                     roughness:.95,metalness:.0, color:0x241a10,normalScale:new THREE.Vector2(.4,.4)});
  const matTrim =new THREE.MeshStandardMaterial({color:0x150a02,roughness:.3,metalness:.15});
  const matFrame=new THREE.MeshStandardMaterial({color:0x160b01,roughness:.28,metalness:.12});
  const matGold =new THREE.MeshStandardMaterial({color:0x8a6415,roughness:.18,metalness:.88});
  const matBeam =new THREE.MeshStandardMaterial({color:0x180d03,roughness:.7});
  const matLamp =new THREE.MeshStandardMaterial({color:0x1a1a1a,roughness:.35,metalness:.7});
  const matBulb =new THREE.MeshStandardMaterial({color:0xffc870,emissive:0xffc870,emissiveIntensity:5,roughness:.2});
  const matCord =new THREE.MeshStandardMaterial({color:0x080808,roughness:.9});

  // ── Room ─────────────────────────────────────────────────────────────────
  const pl=(geo,mat,rx,ry,x,y,z,recv=false)=>{
    const m=new THREE.Mesh(geo,mat);
    if(rx)m.rotation.x=rx;if(ry)m.rotation.y=ry;
    m.position.set(x,y,z);m.receiveShadow=recv;scene.add(m);return m;
  };
  pl(new THREE.PlaneGeometry(CW,CL),matFloor,-Math.PI/2,0,0,0,0,true);
  pl(new THREE.PlaneGeometry(CW,CL),matCeil,Math.PI/2,0,0,WH,0);
  pl(new THREE.PlaneGeometry(CL,WH),matWall,0,Math.PI/2,-hw,WH/2,0,true);
  pl(new THREE.PlaneGeometry(CL,WH),matWall,0,-Math.PI/2,hw,WH/2,0,true);
  pl(new THREE.PlaneGeometry(CW,WH),matWall,0,0,0,WH/2,-hl+.05,true);
  pl(new THREE.PlaneGeometry(CW,WH),matWall,0,Math.PI,0,WH/2,hl-.05);

  const bx=(w,h,d,mat,x,y,z,ry=0,cast=false)=>{
    const m=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mat);
    m.rotation.y=ry;m.position.set(x,y,z);
    if(cast){m.castShadow=true;m.receiveShadow=true;}
    scene.add(m);return m;
  };
  // Baseboards
  bx(CL,.18,.07,matTrim,-hw+.035,.09,0,Math.PI/2);
  bx(CL,.18,.07,matTrim,hw-.035,.09,0,-Math.PI/2);
  // Chair rail
  bx(CL,.08,.055,matTrim,-hw+.028,1.06,0,Math.PI/2);
  bx(CL,.08,.055,matTrim,hw-.028,1.06,0,-Math.PI/2);
  // Crown molding
  bx(CL,.20,.09,matTrim,-hw+.045,WH-.10,0,Math.PI/2);
  bx(CL,.20,.09,matTrim,hw-.045,WH-.10,0,-Math.PI/2);
  // Ceiling beams
  for(let z=-hl+4.5;z<hl;z+=5.5) bx(CW+.12,.22,.28,matBeam,0,WH-.11,z,0,true);

  // ── Pendant lamps ─────────────────────────────────────────────────────────
  for(let z=-hl+3.5;z<=hl-3.5;z+=5.5){
    const housing=new THREE.Mesh(new THREE.CylinderGeometry(.10,.14,.28,16),matLamp);
    housing.position.set(0,WH-.14,z);housing.castShadow=true;scene.add(housing);
    const shade=new THREE.Mesh(new THREE.ConeGeometry(.13,.18,16,1,true),
      new THREE.MeshStandardMaterial({color:0x222222,roughness:.5,metalness:.4,side:THREE.BackSide}));
    shade.position.set(0,WH-.24,z);scene.add(shade);
    const cord=new THREE.Mesh(new THREE.CylinderGeometry(.007,.007,.45,6),matCord);
    cord.position.set(0,WH-.45,z);scene.add(cord);
    const bulb=new THREE.Mesh(new THREE.SphereGeometry(.055,10,10),matBulb);
    bulb.position.set(0,WH-.46,z);scene.add(bulb);
    const pt=new THREE.PointLight(0xffb040,1.9,12,1.9);
    pt.position.set(0,WH-.46,z);scene.add(pt);
  }

  // ── Photo frames ──────────────────────────────────────────────────────────
  const PW=2.4,PH=1.7,PER=5,STEP=CL/(PER+1),EPS=.004;
  for(let i=0;i<10;i++){
    const isLeft=i<5,idx=isLeft?i:i-5;
    const z=hl-STEP*(idx+1);
    const wX=isLeft?-hw:hw;
    const rotY=isLeft?Math.PI/2:-Math.PI/2;
    const dir=isLeft?1:-1;

    bx(PW+.32,PH+.32,.08,matFrame,wX+dir*.038,2.0,z,rotY,true);
    bx(PW+.12,PH+.12,.07,matGold,wX+dir*.042,2.0,z,rotY);

    const geo=new THREE.PlaneGeometry(PW,PH);
    const mat=new THREE.MeshStandardMaterial({color:0x2e2418,roughness:.9,emissive:new THREE.Color(.04,.03,.015),emissiveIntensity:1});
    const pm=new THREE.Mesh(geo,mat);
    pm.rotation.y=rotY;
    pm.position.set(wX+dir*(.042+.035+EPS),2.0,z);
    pm.userData.photoIndex=i;
    scene.add(pm);photoMeshes.push(pm);

    const sX=isLeft?-.8:.8;
    const spot=new THREE.SpotLight(0xffe8b8,3.8,9,Math.PI/11,.28,1.5);
    spot.position.set(sX,WH-.18,z);
    spot.target.position.set(wX+dir*.1,2.0,z);
    spot.castShadow=true;
    spot.shadow.mapSize.set(1024,1024);
    spot.shadow.camera.near=.3;spot.shadow.camera.far=9;
    spot.shadow.bias=-.002;
    scene.add(spot);scene.add(spot.target);
  }

  // ── Load photo textures ───────────────────────────────────────────────────
  await Promise.all(PHOTOS.map((p,i)=>loadTex(p.url,[1,1]).then(tex=>{
    photoMeshes[i].material=new THREE.MeshStandardMaterial({
      map:tex,roughness:.82,
      emissive:new THREE.Color(.04,.03,.015),emissiveIntensity:1
    });
    tickProgress();
  })));

  // ── Lighting — balanced between dark and bright ───────────────────────────
  // Ambient: present but restrained
  scene.add(new THREE.AmbientLight(0x2a1608,0.65));

  // Hemisphere: warm top, near-black floor
  const hemi=new THREE.HemisphereLight(0x503010,0x0c0604,0.38);
  hemi.position.set(0,WH,0);scene.add(hemi);

  // Wall wash: reveals textures without blowing out
  [-hw+.4,hw-.4].forEach(x=>{
    [-hl*.5,0,hl*.5].forEach(z=>{
      const w=new THREE.PointLight(0x6a3510,.22,8,2);
      w.position.set(x,WH*.55,z);scene.add(w);
    });
  });

  // Floor bounce
  [-hl*.4,0,hl*.4].forEach(z=>{
    const fl=new THREE.PointLight(0x3a1a06,.20,6,2);
    fl.position.set(0,.22,z);scene.add(fl);
  });

  // ── Reveal canvas and show intro ──────────────────────────────────────────
  // Render one frame fully before revealing anything
  renderer.render(scene,camera);

  ldBar.style.width='100%';
  ldPct.textContent='100%';
  await new Promise(r=>setTimeout(r,400));

  // Show intro instantly behind loading so canvas is never exposed
  const intro=document.getElementById('intro');
  intro.style.transition='none';
  intro.style.opacity='1';
  intro.style.pointerEvents='all';
  intro.classList.add('visible');

  // Wait two paint frames — intro is now fully on screen covering canvas
  await new Promise(r=>requestAnimationFrame(()=>requestAnimationFrame(r)));

  // Fade loading out — intro already covers everything underneath
  const loadEl=document.getElementById('loading');
  loadEl.classList.add('fade');
  await new Promise(r=>setTimeout(r,1200));
  loadEl.style.display='none';

  // Restore transition so clicking "Entra" still fades the intro out
  intro.style.transition='opacity 1.4s ease';
}

buildScene();

// ── CONTROLS ─────────────────────────────────────────────────────────────────
const keys={};
let yaw=0,pitch=0,pointerLocked=false,galleryActive=false,overlayOpen=false,pendingClick=false;

const cursorEl   =document.getElementById('cursor');
const crosshairEl=document.getElementById('crosshair');
const interactEl =document.getElementById('interact-hint');
const lockMsgEl  =document.getElementById('lock-msg');
const overlayEl  =document.getElementById('photo-overlay');
const overlayImg =document.getElementById('overlayImg');
const overlayCap =document.getElementById('photoCaption');

document.addEventListener('keydown',e=>{keys[e.code]=true;});
document.addEventListener('keyup',  e=>{keys[e.code]=false;});

document.addEventListener('mousemove',e=>{
  cursorEl.style.left=e.clientX+'px';
  cursorEl.style.top =e.clientY+'px';
  if(!pointerLocked)return;
  yaw  -=e.movementX*.0022;
  pitch-=e.movementY*.0022;
  pitch=Math.max(-Math.PI*.38,Math.min(Math.PI*.38,pitch));
});

document.addEventListener('pointerlockchange',()=>{
  pointerLocked=document.pointerLockElement===canvas;
  cursorEl.classList.toggle('hidden',pointerLocked);
  lockMsgEl.style.display=(!pointerLocked&&galleryActive&&!overlayOpen)?'flex':'none';
});

canvas.addEventListener('click',()=>{
  if(!galleryActive||overlayOpen)return;
  if(!pointerLocked){canvas.requestPointerLock();return;}
  if(hoveredPhoto&&!pendingClick){
    pendingClick=true;
    openPhoto(hoveredPhoto);
    setTimeout(()=>{pendingClick=false;},400);
  }
});

document.addEventListener('keydown',e=>{
  if(e.code==='KeyE'&&hoveredPhoto&&pointerLocked&&!overlayOpen)openPhoto(hoveredPhoto);
  if(e.code==='Escape'&&overlayOpen)closePhoto();
});

// ── RAYCASTER ─────────────────────────────────────────────────────────────────
const ray=new THREE.Raycaster();
const sc=new THREE.Vector2(0,0);
let hoveredPhoto=null;

function checkHover(){
  ray.setFromCamera(sc,camera);
  const hits=ray.intersectObjects(photoMeshes,false);
  if(hits.length&&hits[0].distance<3.8){
    hoveredPhoto=hits[0].object;
    interactEl.style.opacity='1';
    crosshairEl.classList.add('active');
  }else{
    hoveredPhoto=null;
    interactEl.style.opacity='0';
    crosshairEl.classList.remove('active');
  }
}

// ── PHOTO OVERLAY ─────────────────────────────────────────────────────────────
function openPhoto(mesh){
  const d=PHOTOS[mesh.userData.photoIndex];
  overlayImg.src=d.url;
  overlayCap.textContent=d.title;
  overlayOpen=true;
  overlayEl.style.display='flex';
  requestAnimationFrame(()=>{overlayEl.style.opacity='1';});
  document.exitPointerLock();
}
function closePhoto(){
  overlayEl.style.opacity='0';
  overlayOpen=false;
  lockMsgEl.style.display='none';
  setTimeout(()=>{
    overlayEl.style.display='none';
    overlayImg.src='';
    canvas.requestPointerLock();
  },500);
}
document.getElementById('photoClose').addEventListener('click',closePhoto);
overlayEl.addEventListener('click',e=>{if(e.target===overlayEl)closePhoto();});

// ── COLLISION ─────────────────────────────────────────────────────────────────
function clamp(p){
  p.x=Math.max(-hw+.38,Math.min(hw-.38,p.x));
  p.z=Math.max(-hl+.38,Math.min(hl-.38,p.z));
}

// ── ENTER ─────────────────────────────────────────────────────────────────────
document.getElementById('enterBtn').addEventListener('click',()=>{
  const intro=document.getElementById('intro');
  intro.style.opacity='0';
  intro.style.pointerEvents='none';
  setTimeout(()=>{
    intro.style.display='none';
    galleryActive=true;
    const hud=document.getElementById('hud');
    hud.style.display='flex';
    crosshairEl.style.display='block';
    interactEl.style.display='block';
    setTimeout(()=>{hud.style.opacity='1';},100);
    canvas.requestPointerLock();
  },1400);
});

// ── RENDER LOOP ───────────────────────────────────────────────────────────────
const clock=new THREE.Clock();
const SPEED=4.2;

(function animate(){
  requestAnimationFrame(animate);
  const dt=Math.min(clock.getDelta(),.05);
  if(galleryActive&&pointerLocked&&!overlayOpen){
    const fwd  =new THREE.Vector3(-Math.sin(yaw),0,-Math.cos(yaw));
    const right=new THREE.Vector3( Math.cos(yaw),0,-Math.sin(yaw));
    const vel  =new THREE.Vector3();
    if(keys['KeyW']||keys['ArrowUp'])    vel.addScaledVector(fwd,   1);
    if(keys['KeyS']||keys['ArrowDown'])  vel.addScaledVector(fwd,  -1);
    if(keys['KeyA']||keys['ArrowLeft'])  vel.addScaledVector(right,-1);
    if(keys['KeyD']||keys['ArrowRight']) vel.addScaledVector(right, 1);
    if(vel.lengthSq()>0)vel.normalize().multiplyScalar(SPEED*dt);
    camera.position.add(vel);
    clamp(camera.position);
    camera.position.y=1.72;
  }
  camera.quaternion.setFromEuler(new THREE.Euler(pitch,yaw,0,'YXZ'));
  if(galleryActive&&!overlayOpen)checkHover();
  renderer.render(scene,camera);
})();

window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
